---
title: "Package development."
subtitle: "Creating impact from code."
author: "Emma Rand and Susannah Cowtan."
institute: "Forwards"
date: "updated: `r Sys.Date()`"
about:
  license_file: LICENSE
output:
  xaringan::moon_reader:
    seal: false
    css: [metropolis, default, metropolis-fonts]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE,	
                      warning = FALSE)
options(htmltools.dir.version = FALSE)
```

```{r pkgs, include=FALSE}
library(RefManageR)
library(kableExtra)
library(dplyr)
library(png)
library(grid)
```

```{r, load-refs, include=FALSE, cache=FALSE}
BibOptions(check.entries = FALSE,
           bib.style = "numeric",
           cite.style = "authoryear",
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("bibliography.bib", check = FALSE)
```

background-image: url(pics/forwards.svg)
background-position: 50% 65%
background-size: 250px

class: inverse

# Package development.

## Creating impact from code.

### Emma Rand and Susannah Cowtan. 

### York January 2020.

Updated: `r Sys.Date()`

.footnote[
[1] https://github.com/forwards/workshops/blob/master/Computing_requirements.md  
[2] Made with xaringan `r Cite(myBib, "xaringan")`

]
---
background-image: url(pics/forwards.svg)
background-position: 50% 55%
background-size: 250px

class: inverse center

# Preliminaries.
---

# Preliminaries. 

## Welcome! Who are we?

.pull-left[

```{r, out.width = "200px", echo=FALSE}
knitr::include_graphics("pics/emma.png")
```

### Emma Rand
Lecturer (Assistant Professor), Department of Biology University of York, UK

I'm a biologist by training. 

Long time R user, relatively new to Python.

]

.pull-right[

```{r, out.width = "200px", echo=FALSE}
knitr::include_graphics("pics/emma.png")
```

### Susannah Cowtan
Postgraduate Student, Department of xx University of Sheffield, UK

biography.

]
---

# Preliminaries. 

## The material is mostly drawn from:

http://r-pkgs.had.co.nz/ `r Cite(myBib, "Wickham:2015:RP:2904414")`

```{r, out.width = "200px", echo=FALSE}
knitr::include_graphics("pics/r-pkgs-cover.png")
```


---
# Preliminaries. 

## The bad news

### .... it may be frustrating
```{r, out.width = "400px", echo=FALSE}
knitr::include_graphics("pics/allie_brosh_argh.png")
```

.footnote[
COPYRIGHT: Allie Brosh  http://hyperboleandahalf.blogspot.com/2010/09/four-levels-of-social-entrapment.html
]


---
# Preliminaries. 

## The good news!

### .... frustration is normal and temporary.
```{r, out.width = "400px", echo=FALSE}
knitr::include_graphics("pics/allie_brosh_happy.png")
```

.footnote[
COPYRIGHT: Allie Brosh  http://hyperboleandahalf.blogspot.com/2010/06/this-is-why-ill-never-be-adult.html
]

---
# Preliminaries. 

## Why make a package

* You want to generalise.
* You want to document.
* You want to disseminate.
* You want to collaborate.
* You want to create impact from your work.

---
# Preliminaries.

## Get to know your R installation.

```{r}
R.home()

```

The R home directory is the top-level directory of the R installation being run.

---
# Preliminaries.

## Get to know your R installation.

```{r}
list.files(R.home())
```

---
# Preliminaries.

## Get to know your R installation.

```{r}
R.version
```

---
# Preliminaries.

## Where do R packages come from?

```{r, out.width = "200px", echo=FALSE}
knitr::include_graphics("pics/stork.png")
```

--

### CRAN and GitHub, mostly

```{r, eval=FALSE}
install.packages("foo")
library(devtools)
install_github("jane/foo")
```

---
# Preliminaries.

## Where do R packages live on your computer?

```{r, out.width = "300px", echo=FALSE}
knitr::include_graphics("pics/library.png")
```

--
### R packages live in a library.

---
# Preliminaries.

## Get to know your R library.

The default library:

```{r}
.Library
```

--
All the libraries R knows about:

```{r}
.libPaths()
```


---
# Preliminaries.

## Get to know your R library.

* For many R users `.Library` and `.libPaths()` are the same.  
* Other R users maintain, or have access to, multiple libraries
* For example, you can put add-on packages in a user-level library:
`C:/Users/Emma Rand/Documents/R/win-library/3.6`

---
# Preliminaries.

## Before we start:

### Make sure you have recent versions of:

`devtools`  
`pkgdown`  
`roxygen2`  
`testthat`   
`tidyverse`  
`usethis`  

### Load`devtools`

```{r}
library(devtools)
```


---
background-image: url(pics/forwards.svg)
background-position: 50% 55%
background-size: 250px

class: inverse center

# Your first package.

---
# Your first package.

## To create a package.

Be deliberate about where you create your package.

Do not nest inside another RStudio project, R package or git repo

```{r eval=FALSE}
usethis::create_package("path/to/mypackage")
```

This will:

* create a new R project called mypackage. which is a package and an RStudio package.
* restart R in the new project.
* create a skeleton structure for your package.
* start an RStudio helper menu.

---
# Your first package.

## What is in this skeleton?

```{r, out.width = "500px", echo=FALSE}
knitr::include_graphics("pics/createpkg1.png")
```



---
# Your first package.

## What is in this skeleton?

### Files and directories.


* `.Rbuildignore` lists files that we need to have around but that should not be included when building the R package from source. e.g., the `.Rproj` file and the LICENSE
* `.Rproj.user`, if you have it, is a directory used internally by RStudio.
* `.gitignore` anticipates Git usage and ignores some standard, behind-the-scenes files created by R and RStudio.
* `DESCRIPTION` provides metadata about your package. We will need to edit this.
* `NAMESPACE` declares the functions your package exports for external use and the external functions your package imports from other packages.
* The `R/` directory is the “business end” of your package. It will contain .R files with function definitions.
* `mypackage.Rproj` is the file that makes this directory an RStudio Project.


---
# Your first package.

## Build pane appears.

```{r, out.width = "500px", echo=FALSE}
knitr::include_graphics("pics/createpkg2.png")
```


---
# Your first package.

## Use version control.

This is optional but strongly recommended.

```{r eval=FALSE}
use_git()
```

---
# Your first package.

## Version control: commit files

There are 5 uncommitted files:

Is it OK to commit them?

Say "I agree" (option 3):

```{r, out.width = "600px", echo=FALSE}
knitr::include_graphics("pics/git_agree.png")
```


---
# Your first package.

## Version control: Restart R

A restart of R is required to activate the Git pane. Restart now?

Say "Yup" (option 3): 

```{r, out.width = "600px", echo=FALSE}
knitr::include_graphics("pics/git_yup.png")
```


---
# Your first package.

## Version control:  RStudio Git pane.

```{r, out.width = "500px", echo=FALSE}
knitr::include_graphics("pics/git_pane.png")
```


---
# References

```{r refs, echo=FALSE, results="asis"}
PrintBibliography(myBib)
```

---
# License

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Package Development: Creating impact from code.</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">R Forwards</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
